<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>플레이 기록 목록 - EscapeLog</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/custom.css}">
</head>

<body class="bg-background text-foreground">
<!-- ✅ 공통 대시보드 헤더 -->
<div th:replace="fragments/dashboardHeader :: dashboard-header('records')"></div>

<main class="container py-5">

    <!-- 제목 + 새 플레이 기록 버튼 (venues 와 동일 레이아웃) -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0">🔒 등록된 플레이 기록</h2>
        <a th:href="@{/playRecords/new}" class="btn btn-primary">
            ＋ 새 플레이 기록
        </a>
    </div>

    <!-- 🔍 검색 + 정렬 -->
    <form th:action="@{/playRecords}" method="get" class="d-flex flex-column gap-2 mb-4">

        <!-- 🔍 검색 영역 -->
        <div class="d-flex align-items-center mb-3">
            <input type="text"
                   name="keyword"
                   class="form-control"
                   placeholder="테마명, 매장명 또는 한줄평으로 검색"
                   th:value="${keyword}">

            <button type="submit"
                    name="action"
                    value="search"
                    class="btn btn-outline-secondary"
                    style="
                        border-radius: 16px;
                        padding: 10px 18px;
                        margin-left: 12px;
                        min-width: 80px;
                    ">
                검색
            </button>
        </div>

        <!-- 정렬 옵션 + 적용/초기화 (venues 와 동일 스타일) -->
        <div class="d-flex justify-content-end align-items-center gap-3 sort-group">

            <select id="sortSelect"
                    name="sort"
                    class="form-select"
                    style="max-width: 220px;">
                <option value=""
                        th:selected="${sort} == null or sort == ''">
                    정렬 없음
                </option>
                <option value="dateDesc"
                        th:selected="${sort} == 'dateDesc'">
                    최신순(최근 플레이 먼저)
                </option>
                <option value="dateAsc"
                        th:selected="${sort} == 'dateAsc'">
                    오래된순(예전 플레이 먼저)
                </option>
            </select>

            <button type="submit"
                    name="action"
                    value="sort"
                    class="btn btn-outline-primary round-btn">
                적용
            </button>

            <a th:href="@{/playRecords}" class="btn btn-outline-secondary round-btn">
                초기화
            </a>
        </div>
    </form>

    <!-- 📋 플레이 기록 리스트 테이블 -->
    <table class="table table-hover align-middle shadow-sm bg-card">
        <thead class="table-light">
        <tr>
            <th>번호</th>
            <th>플레이 날짜</th>
            <th>테마</th>
            <th>매장</th>
            <th>결과</th>
            <th>클리어 시간</th>
            <th>힌트</th>
            <th>평점</th>
            <th>한줄평</th>
        </tr>
        </thead>
        <tbody>
        <!-- playRecords : List<PlayRecord> -->
        <tr th:each="record, iterStat : ${playRecords}">
            <td th:text="${iterStat.count}">1</td>
            <td th:text="${#temporals.format(record.playDate, 'yyyy-MM-dd')}">2025-11-13</td>
            <td th:text="${record.theme.title}">사라진 연구소의 비밀</td>
            <td th:text="${record.theme.venue.name}">홍대 이스케이프 룸</td>
            <td th:text="${record.cleared} ? '성공' : '실패'">성공</td>
            <!-- 성공일 때만 시간 표시, 실패면 '-' -->
            <td th:text="${record.cleared} ? ${record.clearTimeSec + '초'} : '-'">3600초</td>            <td th:text="${record.hintCount + '개'}">2개</td>
            <td th:text="${record.rating + '점'}">4점</td>
            <td th:text="${record.comment}">오늘 컨디션이 좋았다!</td>
        </tr>

        <!-- 목록이 비어 있을 때 -->
        <tr th:if="${#lists.isEmpty(playRecords)}">
            <td colspan="9" class="text-center text-muted py-4">
                등록된 플레이 기록이 없습니다.
            </td>
        </tr>
        </tbody>
    </table>

    <a th:href="@{/dashboard}" class="btn btn-outline-secondary mt-3">
        대시보드로 돌아가기
    </a>
</main>
</body>
</html>
