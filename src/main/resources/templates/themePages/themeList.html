<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>테마 목록 - EscapeLog</title>
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/custom.css}">
</head>

<body class="bg-background text-foreground">
<!-- ✅ 공통 대시보드 헤더 -->
<div th:replace="fragments/dashboardHeader :: dashboard-header('themes')"></div>

<main class="container py-5">

    <!-- 제목 + 새 테마 등록 버튼 -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="mb-0">🔒 등록된 테마 목록</h2>
        <a th:href="@{/themes/new}" class="btn btn-primary">
            ＋ 새 테마 등록
        </a>
    </div>

    <!-- 🔍 검색 + 장르 필터 + 정렬 -->
    <form th:action="@{/themes}" method="get" class="d-flex flex-column gap-2 mb-4">

        <!-- 🔍 검색 영역 -->
        <div class="d-flex align-items-center mb-3">
            <input type="text"
                   name="keyword"
                   class="form-control"
                   placeholder="테마명 또는 매장명으로 검색"
                   th:value="${keyword}">

            <button type="submit"
                    name="action"
                    value="search"
                    class="btn btn-outline-secondary"
                    style="
                        border-radius: 16px;
                        padding: 10px 18px;
                        margin-left: 12px;
                        min-width: 80px;
                    ">
                검색
            </button>
        </div>

        <!-- 🎭 장르 필터 (멀티 선택 박스) -->
        <div class="d-flex align-items-start mb-3 gap-3">
            <div class="pt-2 fw-semibold">장르</div>

            <div class="flex-grow-1">
                <select name="genres"
                        multiple
                        class="form-select"
                        style="max-width: 320px; min-height: 90px;">

                    <!-- availableGenres : Set<Genre> -->
                    <option th:each="g : ${availableGenres}"
                            th:value="${g.name}"
                            th:text="${g}"
                            th:selected="${selectedGenres != null and selectedGenres.contains(g)}">
                    </option>
                </select>

                <small class="text-muted">
                    ⌃ Ctrl(또는 ⌘) / Shift 를 사용하여 여러 장르 선택 가능
                </small>
            </div>
        </div>

        <!-- 정렬 옵션 -->
        <div class="d-flex justify-content-end align-items-center gap-3 sort-group">

            <select id="sortSelect"
                    name="sort"
                    class="form-select"
                    style="max-width: 220px;">
                <option value=""
                        th:selected="${sort} == null or sort == ''">
                    정렬 없음
                </option>
                <option value="difficultyAsc"
                        th:selected="${sort} == 'difficultyAsc'">
                    난이도 낮은 순
                </option>
                <option value="difficultyDesc"
                        th:selected="${sort} == 'difficultyDesc'">
                    난이도 높은 순
                </option>
            </select>

            <button type="submit"
                    name="action"
                    value="sort"
                    class="btn btn-outline-primary round-btn">
                적용
            </button>

            <a th:href="@{/themes}" class="btn btn-outline-secondary round-btn">
                초기화
            </a>
        </div>
    </form>

    <!-- 📋 테마 리스트 테이블 -->
    <table class="table table-hover align-middle shadow-sm bg-card">
        <thead class="table-light">
        <tr>
            <th>번호</th>
            <th>테마명</th>
            <th>매장</th>
            <th>난이도</th>
            <th>제한 시간</th>
            <th>인원</th>
            <th>장르</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="theme, iterStat : ${themes}">
            <td th:text="${iterStat.count}">1</td>
            <td th:text="${theme.title}">사라진 연구소의 비밀</td>
            <td th:text="${theme.venue.name}">홍대 이스케이프 룸</td>
            <td th:text="${theme.difficulty != null ? theme.difficulty : '-'}">3</td>
            <td th:text="${theme.durationMin != null ? theme.durationMin + '분' : '-'}">80분</td>
            <td th:text="${theme.minPlayer + ' ~ ' + theme.maxPlayer + '명'}">2 ~ 6명</td>
            <td>
                <span class="badge bg-white border text-primary me-1"
                      th:each="g : ${theme.genres}"
                      th:text="${g}">
                </span>
            </td>
        </tr>

        <tr th:if="${#lists.isEmpty(themes)}">
            <td colspan="7" class="text-center text-muted py-4">
                등록된 테마가 없습니다.
            </td>
        </tr>
        </tbody>
    </table>

    <a th:href="@{/dashboard}" class="btn btn-outline-secondary mt-3">
        대시보드로 돌아가기
    </a>
</main>
</body>
</html>
